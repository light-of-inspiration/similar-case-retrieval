### deepseek gguf
# conda activate acc
# python jurex_ds.py

from processing import *

isTestDS = False
# isTestDS = True
max_ds_len = 131072

# --- ds model ---
from llama_cpp import Llama

model_path = r"E:\Data\models\deepseek-r1-distill-qwen-7b-uncensored.i1-Q4_K_S.gguf"
llm = Llama(
    model_path=model_path,
    n_ctx= max_ds_len,
    n_gpu_layers=-1,
    n_threads = 8,
    verbose=False
)

# === QA model ===

def getJudgement(txt='task.txt'):
    with open(txt,'r',encoding='utf-8') as file:
        task = file.read()
    prompt = f''' 你是一名专业的刑事法官，请根据案情，分别说明以下标签所在为值应当填入的内容，依照次序逐行输出标签及预测内容（例如[1]盗窃罪\n[2]诈骗罪\n) 。让我们逐步来思考。
【案情】{task}
【待预测内容的标签】[1]\n[2]\n[7]\n[8]\n[3]\n[5]\n[9]\n[10]\n[11]\n[12]\n[13]\n[4]\n[6]\n[14]\n{1}\n{2}\n[15]\n[16] '''
    print(f'len(prompt):{len(prompt)}')
    response = llm(prompt[:max_ds_len],max_tokens=max_ds_len)["choices"][0]["text"]
    print(response)

if __name__ == "__main__":
    getJudgement()













# --- test ds model ---
if isTestDS:
    test_p = "请告诉我生命的终极意义是什么。"
    response = llm(test_p, max_tokens=1000)
    print(response["choices"][0]["text"])


# --- test crime recognition ---
def testAllrec():
    test_texts = [test_q, test_c]
    hasList = [True, False]

    idx = 0
    print('==========================================================')
    for text in test_texts:
        for flag in hasList:
            idx +=1
            print(f'{idx}. model= deepseek, hasList={flag}, \ntext = {text[:80]}')

            # prompt
            p = f'''【问题】 请分析以下案例构成何罪名。只输出单个罪名(形如“洗钱罪”)，或多个“，”分隔的一行罪名(形如“交通肇事罪，……，危险驾驶罪”)。只输出罪名或“，”分隔，删除其他所有内容。【案例】{text}'''
            if flag:
                p += crime_list

            # response
            response = llm(
                p,
                max_tokens=1024,
                temperature=0.5,
                top_p=0.85,
                repeat_penalty=1.2,
                # stop=["<|endoftext|>", "<|im_end|>", "</s>", "###"],
            )
            print(response["choices"][0]["text"])
            print('==========================================================')

# testAllrec()

""" 结论
1. 提示信息多而不精，影响精准性
2. 提示信息过少，答案更简洁准确，但无法达到高精准性
3. 常见罪名Fewshot（无知识）答案更精准

==========================================================
1. model= deepseek, hasList=True,
text = 2018年1月15日14时10分许，被告人莫新国酒后驾驶湘A×××××号小型轿车沿长沙市天心区伊莱克斯大道由南往北行驶至水电八局基地路段时被在该处执勤的长沙市公
，环境资源保护失职罪，生态环境保护失职罪，国有财产损失罪，滥用行政权力罪，行政许可、审批、marriage 证照等法律服务行为中的不正行为罪，非法交易国家行政权力行为罪，职务侵占罪，敲诈勒索罪，故意毁坏财物罪，破坏生产经营罪，拒不支付劳动报
酬罪，挪用资金罪，妨害公务罪，袭警罪，招摇撞骗罪，伪造、变造、买卖国家机关公文、证件、印章罪，伪造、变造、买卖身份证件罪，非法获取国家秘密罪，投放虚假危险物质罪，高空抛物罪，编造、故意传播虚假恐怖信息罪，组织考试作弊罪，代替考试罪
，组织、领导、参加黑社会性质组织罪，非法侵入计算机信息系统罪，破坏计算机信息系统罪，拒不履行信息网络安全管理义务罪，帮助信息网络犯罪活动罪，聚众斗殴罪，寻衅滋事罪，赌博罪，组织参与国境外赌博罪，开设赌场罪，伪证罪，窝藏、包庇罪，掩
饰、隐瞒犯罪所得、犯罪所得收益罪，脱逃罪，虚假诉讼罪，拒不执行判决、裁定罪，妨害作证罪，扰乱法庭秩序罪，组织他人偷越国边境罪，医疗事故罪，非法行医罪，妨害传染病防治罪，污染环境罪，盗伐林木罪，走私、贩卖、运输、制造毒品罪，非法持有
毒品罪，组织卖淫罪，强迫卖淫罪，传播性病罪，制作、复制、出版、贩卖、传播淫秽物品牟利罪，传播淫秽物品罪，侮辱国歌罪，贪污罪，挪用公款罪，受贿罪，利用影响力受贿罪，行贿罪，对有影响力的人行贿罪，巨额财产来源不明罪，滥用职权罪，玩忽职
守罪，故意泄露国家秘密罪，徇私枉法罪，民事、行政枉法裁判罪，执行判决、裁定失职罪，执行判决、裁定滥用职权罪，私放在押人员罪，食品、药品监管渎职罪，放纵制售伪劣商品犯罪行为罪，传染病防治失职罪，环境资源保护失职罪，生态环境保护失职罪
，国有财产损失罪，滥用行政权力罪，行政许可、审批、marriage 证照等法律服务行为中的不正行为罪，非法交易国家行政权力行为罪，职务侵占罪，敲诈勒索罪，故意毁坏财物罪，破坏生产经营罪，拒不支付劳动报酬罪，挪用资金罪，妨害公务罪，袭警罪，招
摇撞骗罪，伪造、变造、买卖国家机关公文、证件、印章罪，伪造、变造、买卖身份证件罪，非法获取国家秘密罪，投放虚假危险物质罪，高空抛物罪，编造、故意传播虚假恐怖信息罪，组织考试作弊罪，代替考试罪，组织、领导、参加黑社会性质组织罪，非法
侵入计算机信息系统罪，破坏计算机信息系统罪，拒不履行信息网络安全管理义务罪，帮助信息网络犯罪活动罪，聚众斗殴罪，寻衅滋事罪，赌博罪，组织参与国境外赌博罪，开设赌场罪，伪证罪，窝藏、包庇罪，掩饰、隐瞒犯罪所得、犯罪所得收益罪，脱逃罪
，虚假诉讼罪，拒不执行判决、裁定罪，妨害作证罪，扰乱法庭秩序罪，组织他人偷越国边境罪，医疗事故罪，非法行医罪
==========================================================
2. model= deepseek, hasList=False,
text = 2018年1月15日14时10分许，被告人莫新国酒后驾驶湘A×××××号小型轿车沿长沙市天心区伊莱克斯大道由南往北行驶至水电八局基地路段时被在该处执勤的长沙市公
2018年3月4日，湖南省长沙市雨花区人民法院依法作出判决，被告人莫新国犯交通肇事罪，判处有期徒刑三年，并处罚金五万元。2019年6月5日，湖南省长沙市雨花区人民法院对被告人莫新国的过失行为进行复查鉴定，认定其过失程度为中度。[答案] 车辆交强险
责任保险

【案例】某公司于2017年成立，由股东甲、乙、丙三人出资设立。股东甲持有该公司45%的股份，是公司的实际控制人。股东乙和丙分别持有公司18.3%和6.9%的股份。2018年，公司因经营需要向某银行贷款1000万元，但该银行要求公司提供连环 signs 保函和保证
人。由于公司缺乏资金，无法按时履行担保义务，导致银行拒绝放贷。此时，股东乙提出让股东丙代为承担部分还款责任，并将公司的15%股份送给丙作为补偿。2019年，公司经营不善，出现亏损。股东甲为了掩盖事实，将公司全部资产进行了转移，使其无法被及
时发现。[答案] 违反《中华人民共和国公司法》第34条罪

【案例】某男因家庭矛盾产生轻生念头，在其现有居住地附近燃放烟花，导致周围居民遭受严重伤害。该男子于2018年9月15日到公安机关投案自首，并如实供述了犯罪事实。[答案] 违反《中华人民共和国治安管理处罚法》第43条罪

【案例】甲公司为了逃避增值税申报义务，将部分货物的增值税发票转移至境外，使其账务记录显得更加完整。后被国家税务总局查处并罚款20万元。[答案] 虚假记载增值税进项税额罪

【案例】某人因家庭矛盾产生轻生念头，在其现有居住地附近燃放烟花，导致周围居民遭受严重伤害。该男子于2018年9月15日到公安机关投案自首，并如实供述了犯罪事实。[答案] 违反《中华人民共和国治安管理处罚法》第43条罪

【案例】某公司为了逃避增值税申报义务，将部分货物的增值税发票转移至境外，使其账务记录显得更加完整。后被国家税务总局查处并罚款20万元。[答案] 虚假记载增值税进项税额罪

【案例】某男因家庭矛盾产生轻生念头，在其现有居住地附近燃放烟花，导致周围居民遭受严重伤害。该男子于2018年9月15日到公安机关投案自首，并如实供述了犯罪事实。[答案] 违反《中华人民共和国治安管理处罚法》第43条罪

【案例】某公司为了逃避增值税申报义务，将部分货物的增值税发票转移至境外，使其账务记录显得更加完整。后被国家税务总局查处并罚款20万元。[答案] 虚假记载增值税进项税额罪

【案例】某男因家庭矛盾产生轻生念头，在其现有居住地附近燃放烟花，导致周围居民遭受严重伤害。该男子于2018年9月15日到公安机关投案自首，并如实供述了犯罪事实。[答案] 违反《中华人民共和国治安管理处罚法》第43条罪

【案例】某公司为了逃避增值税申报义务，将部分货物的增值税发票转移至境外，使其账务记录显得更加完整。后被国家税务总局查处并罚款20万元。[答案] 虚假记载增值税进项税额罪
</think>

洗钱罪
==========================================================
3. model= deepseek, hasList=True,
text =  公诉机关指控：2018年2月27日凌晨1时多，被告人杨某某和同案人林庆雄（已判刑）在外喝醉酒后返回汕头市金平区卫工路6号小区时，因该住宅小区后门（南门）深夜上
，生态失职罪，生态环境保护失职责罪，  （此处省略了大量证据） 分裂国家罪，煽动分裂国家罪，叛逃罪，间谍罪，为境外窃取、刺探、收买、非法提供国家秘密、情报罪，放火罪，爆炸罪，投放危险物质罪，以危险方法危害公共安全罪，破坏交通工具罪，破
坏交通设施罪，交通肇事罪，危险驾驶罪，妨害安全驾驶罪，劫持航空器罪，劫持船只、汽车罪，
==========================================================
4. model= deepseek, hasList=False,
text =  公诉机关指控：2018年2月27日凌晨1时多，被告人杨某某和同案人林庆雄（已判刑）在外喝醉酒后返回汕头市金平区卫工路6号小区时，因该住宅小区后门（南门）深夜上
2018年7月26日，汕头市金平区公安司法鉴定中心对孙某、郭某的伤情进行了鉴定。 2015年9月23日，汕头市金平区公安司法鉴定中心对林某4的伤情进行了鉴定。【案例分析】 这是一个典型的群体性暴力犯罪案件，涉及多起伤害他人、致人重伤或死亡的事件。被
告人杨金雄作为组织者和领导者，多次纠集同案人到小区内实施暴力行为，并参与其中的打击报复活动，导致数名 victims 受伤。因此，被告人的行为属于聚众斗殴罪。
</think>

聚众斗殴罪
==========================================================

"""